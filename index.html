<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Aplicación completa para el seguimiento de cuidados post implante capilar con recordatorios, progreso visual y guías detalladas">
  <meta name="keywords" content="implante capilar, cuidados post operatorios, recuperación, seguimiento">
  <meta name="author" content="Hair Care App">
  <title>Cuidados Diario Post Implante Capilar - Seguimiento Completo</title>
  
  <!-- Preconnect para mejorar rendimiento -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiQ3VpZGFkb3MgUG9zdCBJbXBsYW50ZSBDYXBpbGFyIiwic2hvcnRfbmFtZSI6IkNhcGlsYXJDYXJlIiwic3RhcnRfdXJsIjoiLyIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwiYmFja2dyb3VuZF9jb2xvciI6IiNlYWYyZjgiLCJ0aGVtZV9jb2xvciI6IiMyODc0YTYiLCJpY29ucyI6W3sic3JjIjoiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCM2FXUjBhRDBpTVRJNElpQm9aV2xuYUhROUlqRXlPQ0lpSUhacFpYZENiM2c5SWpBZ01DQXhNamd1TURBd01EQXhNamd1TURBd01EQWlJSGh0Ykc1elBTSm9kSFJ3T2k4dmQzZDNMbmN6TG05eVp5OHlNREF3TDNOMlp5SStQR05wY21Oc1pTQmplRDBpTmpRaUlHTjVQU0kyTkNJZ2NqMGlOVEFpSUdacGJHdzlJaU15T0RjMFlUWWlMejQ4TDNOMlp6ND0iLCJzaXplcyI6IjEyOHgxMjgiLCJ0eXBlIjoiaW1hZ2Uvc3ZnK3htbCJ9XX0=">
  
  <!-- Favicon -->
  <link rel="icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgdmlld0JveD0iMCAwIDEyOC4wMDAwMTI4LjAwMDAxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxjaXJjbGUgY3g9IjY0IiBjeT0iNjQiIHI9IjUwIiBmaWxsPSIjMjg3NGE2Ii8+PC9zdmc+">
  
  <style>
    /* Variables CSS mejoradas */
    :root {
      --bg-primary: #f8fafc;
      --bg-secondary: #e2e8f0;
      --bg-card: #ffffff;
      --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --text-primary: #1a202c;
      --text-secondary: #4a5568;
      --text-muted: #718096;
      --accent-primary: #3182ce;
      --accent-secondary: #2c5282;
      --accent-success: #38a169;
      --accent-warning: #d69e2e;
      --accent-error: #e53e3e;
      --accent-info: #3182ce;
      --border-light: #e2e8f0;
      --border-medium: #cbd5e0;
      --shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      --radius-sm: 0.375rem;
      --radius-md: 0.5rem;
      --radius-lg: 0.75rem;
      --radius-xl: 1rem;
      --font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      --transition-fast: 0.15s ease-in-out;
      --transition-normal: 0.3s ease-in-out;
      --transition-slow: 0.5s ease-in-out;
    }

    /* Dark mode variables */
    @media (prefers-color-scheme: dark) {
      :root {
        --bg-primary: #1a202c;
        --bg-secondary: #2d3748;
        --bg-card: #2d3748;
        --text-primary: #f7fafc;
        --text-secondary: #e2e8f0;
        --text-muted: #a0aec0;
        --border-light: #4a5568;
        --border-medium: #718096;
      }
    }

    /* Reset y base */
    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html {
      scroll-behavior: smooth;
      font-size: 16px;
    }

    body {
      font-family: var(--font-family);
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      font-weight: 400;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      min-height: 100vh;
    }

    /* Layout principal */
    .app-container {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      background: var(--bg-gradient);
      padding: 1rem;
    }

    .main-content {
      flex: 1;
      max-width: 800px;
      margin: 0 auto;
      width: 100%;
    }

    /* Header mejorado */
    .app-header {
      text-align: center;
      margin-bottom: 2rem;
      padding: 2rem 1rem;
      background: var(--bg-card);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-lg);
      backdrop-filter: blur(10px);
      background: rgba(255, 255, 255, 0.95);
    }

    .app-title {
      font-size: clamp(1.5rem, 4vw, 2.5rem);
      font-weight: 700;
      color: var(--accent-primary);
      margin-bottom: 0.5rem;
      background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .app-subtitle {
      font-size: 1.1rem;
      color: var(--text-secondary);
      font-weight: 400;
    }

    /* Tarjetas mejoradas */
    .card {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-md);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      border: 1px solid var(--border-light);
      transition: all var(--transition-normal);
    }

    .card:hover {
      box-shadow: var(--shadow-lg);
      transform: translateY(-2px);
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid var(--border-light);
    }

    .card-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    /* Formulario mejorado */
    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-label {
      display: block;
      font-weight: 500;
      color: var(--text-primary);
      margin-bottom: 0.5rem;
      font-size: 0.95rem;
    }

    .form-input {
      width: 100%;
      padding: 0.875rem 1rem;
      font-size: 1rem;
      border: 2px solid var(--border-light);
      border-radius: var(--radius-md);
      background: var(--bg-card);
      color: var(--text-primary);
      transition: all var(--transition-fast);
      font-family: inherit;
    }

    .form-input:focus {
      outline: none;
      border-color: var(--accent-primary);
      box-shadow: 0 0 0 3px rgba(49, 130, 206, 0.1);
    }

    .form-help {
      font-size: 0.875rem;
      color: var(--text-muted);
      margin-top: 0.25rem;
    }

    /* Botones mejorados */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.875rem 1.5rem;
      font-size: 1rem;
      font-weight: 500;
      border: none;
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: all var(--transition-fast);
      text-decoration: none;
      font-family: inherit;
      min-height: 44px;
      position: relative;
      overflow: hidden;
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .btn-primary {
      background: var(--accent-primary);
      color: white;
      box-shadow: var(--shadow-sm);
    }

    .btn-primary:hover:not(:disabled) {
      background: var(--accent-secondary);
      box-shadow: var(--shadow-md);
      transform: translateY(-1px);
    }

    .btn-secondary {
      background: var(--bg-secondary);
      color: var(--text-primary);
      border: 1px solid var(--border-medium);
    }

    .btn-secondary:hover:not(:disabled) {
      background: var(--border-light);
    }

    .btn-full {
      width: 100%;
    }

    /* Progress bar */
    .progress-container {
      margin-bottom: 2rem;
    }

    .progress-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .progress-label {
      font-weight: 500;
      color: var(--text-primary);
    }

    .progress-percentage {
      font-weight: 600;
      color: var(--accent-primary);
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: var(--bg-secondary);
      border-radius: var(--radius-sm);
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent-primary), var(--accent-success));
      border-radius: var(--radius-sm);
      transition: width var(--transition-slow);
      position: relative;
    }

    .progress-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      animation: shimmer 2s infinite;
    }

    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    /* Output mejorado */
    .output-container {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-md);
      overflow: hidden;
      border: 1px solid var(--border-light);
    }

    .output-header {
      background: var(--bg-gradient);
      color: white;
      padding: 1rem 1.5rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .output-content {
      padding: 1.5rem;
      min-height: 200px;
    }

    .day-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--accent-primary);
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .phase-badge {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      border-radius: var(--radius-sm);
      font-size: 0.75rem;
      font-weight: 600;
      color: white;
      margin-left: 0.5rem;
    }

    .care-list {
      list-style: none;
      margin: 0;
      padding: 0;
    }

    .care-item {
      display: flex;
      align-items: flex-start;
      gap: 0.75rem;
      padding: 0.75rem 0;
      border-bottom: 1px solid var(--border-light);
      transition: all var(--transition-fast);
    }

    .care-item:last-child {
      border-bottom: none;
    }

    .care-item:hover {
      background: var(--bg-secondary);
      margin: 0 -1rem;
      padding-left: 1rem;
      padding-right: 1rem;
      border-radius: var(--radius-sm);
    }

    .care-icon {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: var(--accent-primary);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 0.75rem;
      font-weight: 600;
      flex-shrink: 0;
      margin-top: 0.125rem;
    }

    .care-text {
      flex: 1;
      color: var(--text-primary);
      line-height: 1.5;
    }

    /* Milestone */
    .milestone {
      margin-top: 1.5rem;
      padding: 1rem;
      background: linear-gradient(135deg, var(--accent-info), var(--accent-primary));
      color: white;
      border-radius: var(--radius-md);
      font-weight: 500;
      text-align: center;
      box-shadow: var(--shadow-sm);
    }

    /* Stats cards */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .stat-card {
      background: var(--bg-card);
      padding: 1.5rem;
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-sm);
      text-align: center;
      border: 1px solid var(--border-light);
      transition: all var(--transition-normal);
    }

    .stat-card:hover {
      box-shadow: var(--shadow-md);
      transform: translateY(-2px);
    }

    .stat-value {
      font-size: 2rem;
      font-weight: 700;
      color: var(--accent-primary);
      margin-bottom: 0.25rem;
    }

    .stat-label {
      font-size: 0.875rem;
      color: var(--text-secondary);
      font-weight: 500;
    }

    /* Notifications */
    .notification {
      position: fixed;
      top: 1rem;
      right: 1rem;
      background: var(--bg-card);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-lg);
      padding: 1rem 1.5rem;
      max-width: 400px;
      z-index: 1000;
      transform: translateX(100%);
      transition: transform var(--transition-normal);
    }

    .notification.show {
      transform: translateX(0);
    }

    .notification-success {
      border-left: 4px solid var(--accent-success);
    }

    .notification-error {
      border-left: 4px solid var(--accent-error);
    }

    .notification-info {
      border-left: 4px solid var(--accent-info);
    }

    /* Loading states */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Responsive design mejorado */
    @media (max-width: 768px) {
      .app-container {
        padding: 0.5rem;
      }
      
      .card {
        padding: 1rem;
        margin-bottom: 1rem;
      }
      
      .app-header {
        padding: 1.5rem 1rem;
        margin-bottom: 1.5rem;
      }
      
      .stats-grid {
        grid-template-columns: 1fr;
      }
      
      .notification {
        top: 0.5rem;
        right: 0.5rem;
        left: 0.5rem;
        max-width: none;
      }
    }

    /* Accessibility improvements */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    /* Focus styles */
    .btn:focus,
    .form-input:focus {
      outline: 2px solid var(--accent-primary);
      outline-offset: 2px;
    }

    /* Print styles */
    @media print {
      .app-container {
        background: white;
        padding: 0;
      }
      
      .card {
        box-shadow: none;
        border: 1px solid #ccc;
        break-inside: avoid;
      }
      
      .btn {
        display: none;
      }
    }

    /* Animation utilities */
    .fade-in {
      animation: fadeIn 0.5s ease-in-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .slide-in {
      animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
      from { transform: translateX(-20px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
  </style>
</head>
<body>
  <div class="app-container">
    <div class="main-content">
      <!-- Header -->
      <header class="app-header">
        <h1 class="app-title">🌱 Cuidados Post Implante Capilar</h1>
        <p class="app-subtitle">Seguimiento completo de tu recuperación día a día</p>
      </header>

      <!-- Stats Cards -->
      <div class="stats-grid" id="statsGrid" style="display: none;">
        <div class="stat-card">
          <div class="stat-value" id="daysSinceValue">-</div>
          <div class="stat-label">Días transcurridos</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="progressValue">-</div>
          <div class="stat-label">Progreso</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="nextMilestoneValue">-</div>
          <div class="stat-label">Próximo hito</div>
        </div>
      </div>

      <!-- Input Card -->
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">
            📅 Configuración
          </h2>
        </div>
        
        <form id="careForm" novalidate>
          <div class="form-group">
            <label for="implantDate" class="form-label">Fecha del implante</label>
            <input 
              type="date" 
              id="implantDate" 
              class="form-input"
              aria-describedby="dateHelp"
              required
            >
            <div id="dateHelp" class="form-help">
              Selecciona la fecha de tu implante capilar (no puede ser futura)
            </div>
          </div>

          <!-- Progress Bar -->
          <div class="progress-container" id="progressContainer" style="display: none;">
            <div class="progress-header">
              <span class="progress-label">Progreso de recuperación</span>
              <span class="progress-percentage" id="progressPercentage">0%</span>
            </div>
            <div class="progress-bar">
              <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
          </div>

          <button type="submit" class="btn btn-primary btn-full" id="showCareBtn">
            <span id="btnText">🔍 Ver cuidados del día</span>
            <span id="btnLoading" class="loading" style="display: none;"></span>
          </button>
        </form>
      </div>

      <!-- Output Card -->
      <div class="card output-container" id="outputCard" style="display: none;">
        <div class="output-header">
          <span>📋 Cuidados recomendados</span>
        </div>
        <div class="output-content" id="outputContent" aria-live="polite">
          <!-- Content will be populated by JavaScript -->
        </div>
      </div>
    </div>
  </div>

  <!-- Notification container -->
  <div id="notificationContainer"></div>

  <script>
    (() => {
      'use strict';

      // Utility functions
      const $ = (selector) => document.querySelector(selector);
      const $$ = (selector) => document.querySelectorAll(selector);
      const createElement = (tag, className = '', content = '') => {
        const el = document.createElement(tag);
        if (className) el.className = className;
        if (content) el.textContent = content;
        return el;
      };

      // DOM elements
      const elements = {
        form: $('#careForm'),
        dateInput: $('#implantDate'),
        showCareBtn: $('#showCareBtn'),
        btnText: $('#btnText'),
        btnLoading: $('#btnLoading'),
        outputCard: $('#outputCard'),
        outputContent: $('#outputContent'),
        statsGrid: $('#statsGrid'),
        daysSinceValue: $('#daysSinceValue'),
        progressValue: $('#progressValue'),
        nextMilestoneValue: $('#nextMilestoneValue'),
        progressContainer: $('#progressContainer'),
        progressFill: $('#progressFill'),
        progressPercentage: $('#progressPercentage'),
        notificationContainer: $('#notificationContainer')
      };

      // Configuration
      const config = {
        maxDate: new Date().toISOString().split('T')[0],
        defaultDate: '2025-01-15',
        animationDelay: 300,
        notificationDuration: 5000
      };

      // Enhanced care data with more detailed instructions
      const careData = [
        {
          maxDay: 3,
          phase: 'Crítica',
          color: '#e53e3e',
          tasks: [
            'No tocar, rascar ni frotar la zona injertada bajo ninguna circunstancia',
            'Dormir con la cabeza elevada 45° usando almohadas adicionales',
            'Aplicar suero fisiológico estéril cada 2 horas con spray suave',
            'Evitar completamente sol directo, calor, humo y gorras ajustadas',
            'Tomar medicación prescrita: antibióticos, antiinflamatorios y analgésicos',
            'Mantener hidratación óptima (2-3 litros de agua diarios)',
            'Descanso absoluto, evitar estrés y movimientos bruscos de cabeza',
            'No consumir alcohol, tabaco ni bebidas muy calientes',
            'Aplicar compresas frías en frente y sienes si hay inflamación'
          ]
        },
        {
          maxDay: 10,
          phase: 'Inicial',
          color: '#d69e2e',
          tasks: [
            'Primer lavado suave con champú neutro sin sulfatos, sin frotar',
            'Dejar que las costras se caigan naturalmente, no desprender',
            'Evitar peines, cepillos y prendas que rocen la cabeza',
            'Mantener abstinencia de alcohol y tabaco completamente',
            'No piscinas, saunas, baños turcos ni exposición solar directa',
            'Aplicar spray con factores de crecimiento si está prescrito',
            'Dormir aún semiincorporado para reducir inflamación',
            'Continuar con suero fisiológico 3-4 veces al día',
            'Evitar ejercicio intenso y actividades que provoquen sudoración'
          ]
        },
        {
          maxDay: 14,
          phase: 'Estabilización',
          color: '#d69e2e',
          tasks: [
            'Lavados más frecuentes con esponja suave para eliminar residuos',
            'No ejercer presión con gorras, cascos o almohadas duras',
            'Iniciar ejercicio muy ligero: paseos cortos y estiramientos',
            'Consultar médico si persiste picor intenso o enrojecimiento',
            'Dieta rica en antioxidantes: frutas y verduras frescas variadas',
            'Comenzar masajes muy suaves en cuero cabelludo circundante',
            'Protección solar obligatoria con sombrero de ala ancha',
            'Hidratación cutánea con productos recomendados por especialista'
          ]
        },
        {
          maxDay: 30,
          phase: 'Recuperación',
          color: '#38a169',
          tasks: [
            'Lavado normal pero sin frotar bruscamente la zona injertada',
            'Ejercicio moderado evitando sudoración excesiva prolongada',
            'Protección solar constante: crema SPF 50+ o gorra',
            'Efluvio telógeno normal (caída temporal), mantener calma',
            'Dieta equilibrada: proteínas, vitaminas A, C, E y minerales',
            'Suplementos de colágeno y queratina según indicación médica',
            'Evitar tintes, permanentes y tratamientos químicos agresivos',
            'Fotografías de seguimiento para documentar progreso',
            'Primera consulta de control médico programada'
          ]
        },
        {
          maxDay: 60,
          phase: 'Crecimiento Inicial',
          color: '#38a169',
          tasks: [
            'Masajes suaves circulares 2-3 veces por semana (5-10 minutos)',
            'Suplementos específicos: biotina, zinc, hierro y Omega-3',
            'Terapia de luz LED roja: 3 sesiones semanales de 15 minutos',
            'Control médico mensual para evaluar evolución',
            'Considerar PRP (plasma rico en plaquetas) si está indicado',
            'Mesoterapia capilar con vitaminas según recomendación',
            'Ejercicio regular moderado para mejorar circulación',
            'Técnicas de relajación para reducir estrés (yoga, meditación)'
          ]
        },
        {
          maxDay: 90,
          phase: 'Desarrollo',
          color: '#3182ce',
          tasks: [
            'Primeros signos visibles de crecimiento folicular',
            'Documentar progreso con fotografías mensuales',
            'Productos capilares sin sulfatos, parabenos ni alcohol',
            'Introducir Minoxidil si está recomendado y es bien tolerado',
            'Ejercicios de relajación y técnicas de manejo del estrés',
            'Dieta mediterránea rica en antioxidantes y ácidos grasos',
            'Masajes con aceites naturales (jojoba, argán) semanalmente',
            'Evitar exposición prolongada a cloro de piscinas',
            'Mantener rutina de sueño regular (7-8 horas diarias)'
          ]
        },
        {
          maxDay: 180,
          phase: 'Consolidación',
          color: '#3182ce',
          tasks: [
            'Aumento notable en densidad y grosor del cabello',
            'Comparar evolución con fotografías del mes anterior',
            'Masajes con aceite de ricino o romero cada 3-4 días',
            'Evitar tintes agresivos, preferir productos naturales',
            'Evaluación hormonal y nutricional con especialista',
            'Considerar bioestimulación con factores de crecimiento',
            'Ejercicio cardiovascular regular para mejorar circulación',
            'Suplementación con vitaminas del complejo B'
          ]
        },
        {
          maxDay: 365,
          phase: 'Maduración',
          color: '#667eea',
          tasks: [
            'Crecimiento consolidado y uniforme en toda la zona',
            'Rutina de lavado con champú suave y acondicionador',
            'Opcional: micropigmentación para mayor densidad visual',
            'Vitaminas específicas según análisis de sangre',
            'Revisión trimestral y ajustes del tratamiento',
            'Fotografías de comparación con el estado inicial',
            'Mantenimiento con tratamientos de mesoterapia',
            'Evaluación de satisfacción y posibles retoques'
          ]
        },
        {
          maxDay: Infinity,
          phase: 'Mantenimiento',
          color: '#764ba2',
          tasks: [
            'Resultado definitivo alcanzado, mantener rutina',
            'Cuidados de higiene y nutrición como hábitos permanentes',
            'Consultar ante cualquier cambio, caída o irritación',
            'Valorar retoques estéticos o densificadores opcionales',
            'Protección solar permanente en actividades al aire libre',
            'Revisiones anuales para monitoreo a largo plazo',
            'Mantener estilo de vida saludable y manejo del estrés',
            'Compartir experiencia para ayudar a otros pacientes'
          ]
        }
      ];

      // Milestone days for progress tracking
      const milestones = [3, 10, 14, 30, 60, 90, 180, 365];

      // Initialize app
      function init() {
        setupEventListeners();
        setInitialValues();
        loadSavedData();
      }

      function setupEventListeners() {
        elements.form.addEventListener('submit', handleFormSubmit);
        elements.dateInput.addEventListener('change', handleDateChange);
        
        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
          if (e.ctrlKey && e.key === 'Enter') {
            e.preventDefault();
            handleFormSubmit(e);
          }
        });
      }

      function setInitialValues() {
        elements.dateInput.max = config.maxDate;
        elements.dateInput.value = config.defaultDate;
      }

      function loadSavedData() {
        try {
          const savedDate = localStorage.getItem('implantDate');
          if (savedDate && isValidDate(savedDate)) {
            elements.dateInput.value = savedDate;
            updateDisplay();
          }
        } catch (error) {
          console.warn('Could not load saved data:', error);
        }
      }

      function saveData() {
        try {
          localStorage.setItem('implantDate', elements.dateInput.value);
        } catch (error) {
          console.warn('Could not save data:', error);
        }
      }

      function isValidDate(dateString) {
        const date = new Date(dateString);
        const today = new Date();
        return date instanceof Date && !isNaN(date) && date <= today;
      }

      function daysSince(dateStr) {
        const msPerDay = 1000 * 60 * 60 * 24;
        const implantDate = new Date(dateStr);
        const today = new Date();
        return Math.floor((today - implantDate) / msPerDay);
      }

      function getCareForDay(day) {
        if (day < 0) return null;
        return careData.find(phase => day <= phase.maxDay);
      }

      function calculateProgress(day) {
        const maxDays = 365;
        return Math.min((day / maxDays) * 100, 100);
      }

      function getNextMilestone(day) {
        return milestones.find(milestone => day < milestone);
      }

      function showNotification(message, type = 'info') {
        const notification = createElement('div', `notification notification-${type}`);
        notification.innerHTML = `
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <span>${message}</span>
            <button onclick="this.parentElement.parentElement.remove()" style="background: none; border: none; font-size: 1.2rem; cursor: pointer; color: inherit;">×</button>
          </div>
        `;
        
        elements.notificationContainer.appendChild(notification);
        
        // Show notification
        setTimeout(() => notification.classList.add('show'), 100);
        
        // Auto remove
        setTimeout(() => {
          notification.classList.remove('show');
          setTimeout(() => notification.remove(), 300);
        }, config.notificationDuration);
      }

      function updateStats(day) {
        const progress = calculateProgress(day);
        const nextMilestone = getNextMilestone(day);
        
        elements.daysSinceValue.textContent = day;
        elements.progressValue.textContent = `${Math.round(progress)}%`;
        elements.nextMilestoneValue.textContent = nextMilestone ? `${nextMilestone - day} días` : 'Completado';
        
        // Update progress bar
        elements.progressFill.style.width = `${progress}%`;
        elements.progressPercentage.textContent = `${Math.round(progress)}%`;
        
        // Show stats
        elements.statsGrid.style.display = 'grid';
        elements.progressContainer.style.display = 'block';
      }

      function renderCareInstructions(day, carePhase) {
        elements.outputContent.innerHTML = '';
        
        // Day title with phase badge
        const titleContainer = createElement('div', 'day-title');
        titleContainer.innerHTML = `
          📅 Día ${day}
          <span class="phase-badge" style="background-color: ${carePhase.color};">
            Fase ${carePhase.phase}
          </span>
        `;
        elements.outputContent.appendChild(titleContainer);
        
        // Care list
        const careList = createElement('ul', 'care-list');
        carePhase.tasks.forEach((task, index) => {
          const listItem = createElement('li', 'care-item');
          listItem.innerHTML = `
            <div class="care-icon">${index + 1}</div>
            <div class="care-text">${task}</div>
          `;
          careList.appendChild(listItem);
        });
        elements.outputContent.appendChild(careList);
        
        // Next milestone info
        const nextMilestone = getNextMilestone(day);
        if (nextMilestone) {
          const daysToMilestone = nextMilestone - day;
          const milestoneEl = createElement('div', 'milestone');
          milestoneEl.textContent = `⏰ Faltan ${daysToMilestone} día${daysToMilestone !== 1 ? 's' : ''} para el próximo hito del día ${nextMilestone}`;
          elements.outputContent.appendChild(milestoneEl);
        } else {
          const completedEl = createElement('div', 'milestone');
          completedEl.textContent = '🎉 ¡Felicitaciones! Has completado todas las fases principales de recuperación';
          elements.outputContent.appendChild(completedEl);
        }
      }

      function updateDisplay() {
        const day = daysSince(elements.dateInput.value);
        const carePhase = getCareForDay(day);
        
        if (!carePhase) {
          showNotification('Fecha inválida. Por favor selecciona una fecha válida.', 'error');
          return;
        }
        
        updateStats(day);
        renderCareInstructions(day, carePhase);
        
        // Show output card with animation
        elements.outputCard.style.display = 'block';
        elements.outputCard.classList.add('fade-in');
        
        saveData();
      }

      function handleFormSubmit(e) {
        e.preventDefault();
        
        if (!elements.dateInput.value) {
          showNotification('Por favor selecciona una fecha de implante.', 'error');
          elements.dateInput.focus();
          return;
        }
        
        if (!isValidDate(elements.dateInput.value)) {
          showNotification('La fecha no puede ser futura. Por favor selecciona una fecha válida.', 'error');
          elements.dateInput.focus();
          return;
        }
        
        // Show loading state
        elements.btnText.style.display = 'none';
        elements.btnLoading.style.display = 'inline-block';
        elements.showCareBtn.disabled = true;
        
        // Simulate processing time for better UX
        setTimeout(() => {
          updateDisplay();
          showNotification('Cuidados actualizados correctamente', 'success');
          
          // Reset button state
          elements.btnText.style.display = 'inline';
          elements.btnLoading.style.display = 'none';
          elements.showCareBtn.disabled = false;
        }, config.animationDelay);
      }

      function handleDateChange() {
        if (elements.dateInput.value && isValidDate(elements.dateInput.value)) {
          updateDisplay();
        }
      }

      // Initialize app when DOM is loaded
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
      } else {
        init();
      }

      // Service Worker registration for PWA functionality
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('data:application/javascript;base64,c2VsZi5hZGRFdmVudExpc3RlbmVyKCdpbnN0YWxsJywgZXZlbnQgPT4ge2V2ZW50LndhaXRVbnRpbChzZWxmLnNraXBXYWl0aW5nKCkpO30pO3NlbGYuYWRkRXZlbnRMaXN0ZW5lcignYWN0aXZhdGUnLCBldmVudCA9PiB7ZXZlbnQud2FpdFVudGlsKHNlbGYuY2xpZW50cy5jbGFpbSgpKTt9KTs=')
            .then(() => console.log('SW registered'))
            .catch(() => console.log('SW registration failed'));
        });
      }

    })();
  </script>
</body>
</html>
